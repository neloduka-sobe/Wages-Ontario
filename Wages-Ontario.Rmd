---
title: "Analysis of Ontario wages in relation to economic factors based on Ontario Data Catalogue (1997-2019)"
author:
  - "Borys Łangowicz (1010725967)"
  - "Kian Dianati (1010205485)"
date: "2024-04-05"
output:
  html_document:
    number_sections: true
  pdf_document:
    number_sections: true
---

```{r, include=F}
library(tidyverse)
library(ggplot2)
library(reshape2)
library(knitr)
```

# Loading the Data

We will use the following data sets:

```{r}
wages = read.csv("wages.csv") %>% mutate_if(is.character, str_trim)

# Clean age ranges
# Want to achieve:
# 15-24 DONE
# 25-34 DONE
# 35-54 // 25-54 minus 25-34
# 55-64 // 25-64 minus 25-54
# 65+ // 55+ minus 55-64

#wages <- wages %>% group_by(YEAR, Geography, Type.of.work, Wages, )

wages$Education.level =
  factor(wages$Education.level,
         levels = c("Above bachelor's degree",
                    "Bachelor's degree",
                    "University certificate below bachelors degree",
                    "University degree",
                    "Community college, CEGEP",
                    "Trade certificate or diploma",
                    "Post-secondary certificate or diploma",
                    "Some post-secondary",
                    "High school graduate",
                    "Some high school",
                    "PSE  (5,6,7,8,9))",
                    "No PSE  (0,1,2,3,4)",
                    "0 - 8  years",
                    "Total, all education levels"),
         ordered = TRUE)

wages$Age.group =
  factor(wages$Age.group,
         levels = c("25-64 years",
                    "25-54 years",
                    "25-34 years",
                    "20-34 years",
                    "15-24 years",
                    "55 years and over",
                    "25 years and over",
                    "15 years and over"),
         ordered = TRUE)

# Fuel
fuel = read.csv("fuel.csv") %>% mutate_if(is.character, str_trim)

fuel <- fuel %>% rename(
  Toronto.West = Toronto.West.Ouest,
  Toronto.East = Toronto.East.Est,
  St.Catharine = St..Catharine.s,
  Ontario.Average = Ontario.Average.Moyenne.provinciale,
  Southern.Average.Ontario = Southern.Average.Moyenne.du.sud.de.l.Ontario,
  Northern.Average.Ontario = Northern.Average.Moyenne.du.nord.de.l.Ontario 
) %>% select(!(Type.de.carburant)) 
```

# Description of the Data set

## Wages by education level 
The `wages` data set includes the average weekly wages rates by education level 
and immigration status for Canada and Ontario in the years from 1997 to 2019. 
It includes the following columns:

```{r}
names(wages)
```

1. `YEAR`: Indicates the year in which the data was collected.
2. `Geography`: Indicates the region from which the data was collected. Its 
   possible values include Canada as well as the Canadian provinces and 
   territories.
3. `Type.of.work`: Indicates whether the data in the row is for full-time 
   employees or part-time employees or both.
4. `Wages`:
    1. `Total employees`: The number of employees in the given age range, 
       education level, and job status.
    2. `Average hourly wage rate`: The average hourly wage of the employees in 
       the given age range, education level, and job status.
    3. And so on for `Average weekly wage rate`, `Median hourly wage rate`, 
       and `Median weekly wage rate`.
5. `Education.level`: Indicates the level of education. It can include the 
   following:
```{r, echo=FALSE}
kable(wages %>%
  group_by(Education.level) %>%
  reframe(Education.level) %>%
  unique())
```
6. `Age.group`: Indicates the age range of the individuals under consideration.
   It can include the following:
```{r, echo=FALSE}
kable(wages %>%
  group_by(Age.group) %>%
  reframe(Age.group) %>%
  unique())
```
7. `Both.sexes`: The data not seperated by gender.
8. `Male`: The data for males.
9. `Female`: The data for females.

## Fuels price survey information 
```{r}
names(fuel)
```

TODODODODODOODODODO

# The Background of the Data

The labor and demographic dataset from the Ministry of Labour, Immigration, 
Training, and Skills Development provides insights into Ontario's workforce 
demographics, including age groups, employment types, educational levels, wages,
and immigration statuses. It is annually updated and used by policymakers, 
researchers, and economists to inform decisions regarding education, training, 
workforce development, and immigration policies in the province.

Additionally, fuel price survey information from the Ministry of Energy offers 
weekly retail prices for gasoline, diesel, auto propane, and compressed natural 
gas across ten Ontario markets. This data aids in monitoring fuel price 
fluctuations and analyzing trends in the energy sector, supporting research and
analysis efforts in economics, environmental studies, and energy policy.

# Overall Research Question

## Trend Analysis

  * How has the average hourly wage rate changed over the years across different age groups?
  * Are there any noticeable trends in the median weekly wage rate for full-time employees over the past decade?
  * What is the overall trend in the number of full-time employees versus part-time employees across different age groups?
  
## Regional Disparities

  * How do average hourly wage rates vary between different Canadian provinces and territories?
  * Are there significant differences in the employment rates between urban and rural areas within a specific province?
  
## Educational Attainment

  * How does the average hourly wage rate differ across various education levels?
  * Are there any trends in the employment rates based on different levels of education attainment?
  * Is there a correlation between educational attainment and the likelihood of being employed full-time versus part-time?
  
## Age Groups Analysis

  * How do wage rates vary across different age groups, and is there a trend in wage growth as individuals age?
  * Are there noticeable differences in employment rates between younger and older age groups?
  * What is the distribution of educational attainment among different age groups, and how does it correlate with employment status and wage rates?
  
## Gender Analysis

  * Is there a significant gender wage gap, and how has it evolved over time?
  * Are there differences in the distribution of employment types (full-time vs. part-time) between males and females?
  * How does educational attainment affect the gender wage gap within specific age groups or regions?
  
## Overall Employment Trends

  * How has the total number of employees changed over the years?
  * Are there seasonal variations in employment rates or wage rates within certain industries?
  * What industries or sectors have shown the highest growth in employment rates, and how does this correlate with wage rates?
  
# Summary

## How has the average hourly wage rate changed over the years across different age groups?
```{R}
avg_wage_by_age <- wages %>%
  filter(Wages == "Average hourly wage rate",
         Geography == "Canada",
         Type.of.work == "Full-time",
         Education.level == "Total, all education levels") %>%
  select(YEAR, Age.group, Both.Sexes) %>%
  group_by(YEAR, Age.group) %>%
  summarise(Avg_Hourly_Wage = mean(Both.Sexes))

kable(avg_wage_by_age %>%
  pivot_wider(names_from = Age.group, values_from = Avg_Hourly_Wage))
```


```{r}
ggplot(avg_wage_by_age %>% filter(YEAR == "2019"),
       aes(x = Age.group, Avg_Hourly_Wage)) +
  geom_bar(stat = "identity") +
  labs(x = "Age group",
       y = "Average Hourly Wage",
       title = "Wage by Age Group in 2019") +
  theme(text = element_text(size = 8))
```

**From the data, we can observe the following trends:**

1. Across all age groups, there is a general trend of increasing average hourly wage rates over the years.
2. The wage rates tend to increase with age, with the highest rates typically observed in the 55 years and over age group.
3. The 15-24 years age group consistently has the lowest average hourly wage rates, which gradually increase as individuals move into older age groups.
4. There is a noticeable increase in wage rates during the late 1990s and early 2000s, followed by a slight dip during the economic downturn of 2008-2009, after which wages steadily increased again.

These observations provide an overview of how the average hourly wage rates have changed over the years across different age groups.

## How does the average hourly wage rate differ across various education levels for different genders?
```{R}
avg_wage_by_education <- wages %>%
  filter(Wages == "Average hourly wage rate", 
         Geography == "Canada",
         Age.group == "15 years and over",
         Type.of.work == "Both full- and part-time") %>%
  select(Education.level, Male, Female) %>%
  group_by(Education.level) %>%
  summarise(male_avg = mean(Male),
            female_avg = mean(Female))

kable(avg_wage_by_education)
```

```{R}
ggplot(avg_wage_by_education %>% melt(),
       aes(x = Education.level, fill = variable)) +
  geom_bar(aes(y = value), 
           stat = "identity", 
           alpha = 0.8,
           show.legend = TRUE,
           position = position_identity()) +
  labs(title = "Average Hourly Wage Rate by Education Level and Gender",
       x = "Education Level",
       y = "Average Hourly Wage Rate",
       fill = "Gender") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        text = element_text(size = 8),
        legend.position = "bottom") +
  coord_flip()
```
```{r}
kable(avg_wage_by_education %>%
  mutate(pay.gap = male_avg - female_avg))
```

```{r}
ggplot(avg_wage_by_education %>% mutate(pay.gap = male_avg - female_avg), 
       aes(x = Education.level, y = pay.gap)) +
  geom_bar(stat = "identity") +
  labs(y = "Gender Pay Gap",
       x = "Education Level",
       title = "Gender Pay Gap by Education") +
  coord_flip()
```

**Observations:**

1. In almost all cases, the average hourly wage for males is higher than for females across various education levels.
2. The largest wage gaps are observed at "Trade certificate or diploma" where
3. At higher education levels, such as "Above bachelor’s degree" and "Bachelor’s degree", the wage gap is relatively smaller compared to lower education levels but still exists.

These observations highlight disparities in wages between genders across different education levels, indicating the presence of gender-based wage inequality.

## What is the overall trend in the number of full-time employees versus part-time employees across different age groups?

```{R}
unique(wages$Type.of.work)

full_time_part_time <- wages %>% 
  filter(Age.group %in% c("15-24 years", 
                          "25-54 years", 
                          "55 years and over")) %>%
  group_by(Age.group, Type.of.work) %>%
  summarise(Employees = sum(Both.Sexes))

options(scipen = 999)
ggplot(full_time_part_time, 
       aes(x = Age.group, y = Employees, fill = Type.of.work)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Number of Full-time, Part-time vs Part- and Full-time Employees\n Across Age Groups",
       x = "Age Group",
       y = "Number of Employees",
       fill = "Type of Work") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

## What is the relationship between Wages and Fuel Price?

```{R}
fuel.year = fuel %>%
  mutate(Year = year(as.Date(Date))) %>%
  group_by(Year) %>%
  summarise(Avg.Price = mean(Ontario.Average))

wages.year = wages %>%
  filter(Geography == 'Ontario',
         Wages == 'Average hourly wage rate',
         Type.of.work == 'Both full- and part-time',
         Education.level == 'Total, all education levels',
         Age.group == '15 years and over') %>%
  select(YEAR, Both.Sexes)

merged_data <- merge(wages.year, fuel.year, by.x = "YEAR", by.y = "Year")

ggplot(merged_data, aes(x = Both.Sexes, y = Avg.Price)) +
  geom_point() +
  geom_smooth(method = "lm") +
  labs(x = "Average wage", 
       y = "Average fuel price", 
       title = "Relationship between Wages and Fuel Price")

# fuel and wage vs year
ggplot(merged_data, aes(x = YEAR)) +
  geom_line(aes(y = Both.Sexes, color = "Both Sexes"), size = 1.5) +
  geom_line(aes(y = Avg.Price, color = "Avg. Price")) +
  # scale_y_continuous(sec.axis = sec_axis(~./0.1, name = "Avg. Price")) +
  labs(x = "Year", y = "Both Sexes", color = "Legend")

kable(avg_wage_by_education %>%
  mutate(pay.gap = male_avg - female_avg))
```

# Hypothesis Testing
**Null Hypothesis (H0)**: There is no statistically significant distinction in the average wages between male and female workers (μ_male = μ_female).

**Alternative Hypothesis (H1)**: There exists a statistically significant disparity in average wages between male and female workers (μ_male ≠ μ_female).
To examine this hypothesis, we can employ a two-sample t-test to compare the wage distributions of male and female workers. This entails segregating the dataset into two distinct groups based on gender: male and female.

The resultant p-value derived from the selected statistical test indicates the probability of observing a wage difference as extreme as, or more extreme than, the observed difference, assuming the null hypothesis holds. If the obtained p-value falls below the predetermined significance level (typically 0.05), we reject the null hypothesis, indicating a significant discrepancy in wages between male and female workers.

Moreover, by computing a confidence interval for the disparity in mean wages, we can gauge the plausible range of values for the actual difference between male and female wages.

```{R}
male_wages <- wages %>% filter(Wages == "Average weekly wage rate") %>% select(Male)
female_wages <- wages %>% filter(Wages == "Average weekly wage rate") %>% select(Female)

t.test(male_wages, female_wages)
```

**Conclusions**
The outcomes derived from the Welch Two Sample t-test underscore a significant contrast in average earnings between male and female workers. With an extraordinarily minute p-value (< 0.00000000000000022), there's compelling evidence to dismiss the null hypothesis, indicating that the mean wages for men and women diverge significantly. The 95% confidence interval for the mean wage discrepancy extends from 116.8124 to 123.6314, suggesting that the actual difference in wages between male and female workers likely lies within this interval.

In summary, the findings overwhelmingly advocate for rejecting the null hypothesis, underscoring a noteworthy disparity in wages between male and female employees. Specifically, the average wage for male workers (627.8701) markedly exceeds that of female workers (507.6481).

# Bootstrapping

```{R}
library(boot)

mean_fuel_price <- function(data) {
  mean(data[["Toronto.West"]])
}

set.seed(123)
n_boot <- 1000 
bootstrap_means <- replicate(n_boot, {
  sample_data <- fuel[sample(1:nrow(fuel), replace = TRUE), ]
  mean_fuel_price(sample_data)
})

ci <- quantile(bootstrap_means, c(0.025, 0.975))

# Print the results
cat("Mean fuel price for Ontario:", mean(fuel$Toronto.West), "\n")
cat("95% confidence interval:", "( ", ci[1], "-", ci[2], " )", "\n")

```

# Non-linear Regression Analysis

# Cross Validation

# Summary of Research

# Appendix
